<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MeipMorg: Ominous Verses</title>
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Playfair+Display:ital,wght@1,400;1,700&display=swap"
        rel="stylesheet" />
    <style>
        body {
            background-color: #0a0a0a;
            color: #a0a0a0;
            font-family: "Inter", sans-serif;
        }

        .font-serif-display {
            font-family: "Playfair Display", serif;
        }

        .nav-link.active {
            border-bottom: 2px solid white;
        }

        .transition-all {
            transition: all 0.3s ease-in-out;
        }

        .content-card {
            background-color: #1a1a1a;
            border: 1px solid #2a2a2a;
        }

        .content-card:hover {
            border-color: #555;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #111111;
            border: 1px solid #333;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
        }

        .reaction-emoji {
            transition: transform 0.2s ease, filter 0.2s ease;
            filter: grayscale(80%);
        }

        .reaction-emoji:hover {
            transform: scale(1.2);
            filter: grayscale(0%);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .sort-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }

        .sort-select option,
        .form-select option {
            background: #1a1a1a;
            color: #e0e0e0;
            border: 1px solid #333;
        }

        .form-input,
        .form-select,
        .form-textarea {
            background-color: #1a1a1a;
            border: 1px solid #333;
            color: #a0a0a0;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #555;
        }

        .submit-btn {
            background-color: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
        }

        .submit-btn:hover {
            background-color: #3a3a3a;
        }
    </style>
</head>

<body class="antialiased">
    <header class="fixed top-0 left-0 right-0 z-20 pt-4 pb-2 bg-black bg-opacity-30 backdrop-blur-sm">
        <nav class="container mx-auto px-4 flex justify-center items-center">
            <ul id="nav-links" class="flex justify-center items-center space-x-8 md:space-x-12"></ul>
            <li class="list-none ml-8">
                <button id="submit-nav-btn"
                    class="text-white text-sm font-light tracking-widest uppercase border border-gray-600 hover:border-white hover:bg-white hover:text-black rounded-md px-4 py-2 transition-all">
                    Submit Your Content
                </button>
            </li>
        </nav>
        <div class="container mx-auto px-4 flex justify-end mt-2">
            <select id="sort-control"
                class="sort-select bg-transparent border border-gray-700 text-white text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block p-2">
                <option value="date-desc">Sort By: Newest First</option>
                <option value="date-asc">Sort By: Oldest First</option>
                <option value="title-asc">Sort By: Title (A-Z)</option>
                <option value="title-desc">Sort By: Title (Z-A)</option>
                <option value="author-asc">Sort By: Author (A-Z)</option>
                <option value="author-desc">Sort By: Author (Z-A)</option>
            </select>
        </div>
    </header>

    <main class="pt-36 pb-12">
        <section id="content-display" class="container mx-auto px-4">
            <div id="content-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
    </main>

    <div id="content-modal"
        class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div id="modal-content-box"
            class="modal-content w-full max-w-2xl max-h-[90vh] rounded-lg overflow-hidden flex flex-col transform scale-95 transition-transform duration-300">
            <div class="p-6 md:p-8 flex-shrink-0">
                <h2 id="modal-title" class="font-serif-display text-3xl md:text-4xl text-white mb-2"></h2>
                <p id="modal-author" class="text-gray-400 text-sm mb-6"></p>
            </div>
            <div id="modal-body" class="no-scrollbar overflow-y-auto px-6 md:px-8">
                <p id="modal-text" class="text-gray-300 whitespace-pre-wrap leading-relaxed"></p>
            </div>
            <div class="p-6 md:p-8 mt-auto flex-shrink-0">
                <p class="text-center text-gray-500 text-sm mb-4">
                    How did this make you feel?
                </p>
                <div class="flex justify-center items-center space-x-6">
                    <span class="reaction-emoji cursor-pointer text-2xl" data-reaction="üëç">üëç</span>
                    <span class="reaction-emoji cursor-pointer text-2xl" data-reaction="‚ù§Ô∏è">‚ù§Ô∏è</span>
                    <span class="reaction-emoji cursor-pointer text-2xl" data-reaction="üò¢">üò¢</span>
                    <span class="reaction-emoji cursor-pointer text-2xl" data-reaction="ü•≤">ü•≤</span>
                    <span class="reaction-emoji cursor-pointer text-2xl" data-reaction="ü§ó">ü§ó</span>
                </div>
            </div>
            <button id="close-modal"
                class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors text-3xl leading-none">
                &times;
            </button>
        </div>
    </div>

    <div id="submission-modal"
        class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div
            class="modal-content w-full max-w-2xl max-h-[90vh] rounded-lg overflow-hidden flex flex-col transform scale-95 transition-transform duration-300 relative">
            <div class="p-6 md:p-8 flex-shrink-0">
                <h2 class="font-serif-display text-3xl md:text-4xl text-white mb-4">
                    Submit Your Work
                </h2>
                <p class="text-gray-400 text-sm">
                    Share your creation with us. Submissions will be reviewed before
                    publishing.
                </p>
            </div>
            <div class="no-scrollbar overflow-y-auto px-6 md:px-8 pb-8">
                <form id="submission-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="submit-author" class="block mb-2 text-sm font-medium text-gray-300">Author
                                Name</label>
                            <input type="text" id="submit-author"
                                class="bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5"
                                placeholder="Your Name" required />
                        </div>
                        <div>
                            <label for="submit-title" class="block mb-2 text-sm font-medium text-gray-300">Work
                                Title</label>
                            <input type="text" id="submit-title"
                                class="bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5"
                                placeholder="Title of your work" required />
                        </div>
                    </div>
                    <div>
                        <label for="submit-type" class="block mb-2 text-sm font-medium text-gray-300">Type of
                            Content</label>
                        <select id="submit-type"
                            class="form-select bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5">
                            <option>Poem</option>
                            <option>Quote</option>
                            <option>Story</option>
                            <option>Diary Entry</option>
                            <option value="Custom">Custom...</option>
                        </select>
                    </div>
                    <div id="custom-type-container" class="hidden">
                        <label for="submit-custom-type" class="block mb-2 text-sm font-medium text-gray-300">Custom
                            Content Type</label>
                        <input type="text" id="submit-custom-type"
                            class="bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5"
                            placeholder="e.g., Micro-fiction" />
                    </div>
                    <div>
                        <label for="submit-content" class="block mb-2 text-sm font-medium text-gray-300">Your
                            Work</label>
                        <textarea id="submit-content" rows="8"
                            class="bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5"
                            placeholder="Paste or write your content here..." required></textarea>
                    </div>
                    <div class="flex justify-end">
                        <button type="submit"
                            class="text-white bg-gray-700 hover:bg-gray-600 focus:ring-4 focus:outline-none focus:ring-gray-800 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center transition-colors">
                            Submit for Review
                        </button>
                    </div>
                </form>
            </div>
            <button id="close-submission-modal"
                class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors text-3xl leading-none">
                &times;
            </button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const SECTIONS = ["poems", "quotes", "stories", "diaries"];
            let currentSection = SECTIONS[0];

            const siteContent = {};

            const navLinksContainer = document.getElementById("nav-links");
            const contentGrid = document.getElementById("content-grid");
            const modal = document.getElementById("content-modal");
            const modalContentBox = document.getElementById("modal-content-box");
            const modalTitle = document.getElementById("modal-title");
            const modalAuthor = document.getElementById("modal-author");
            const modalText = document.getElementById("modal-text");
            const closeModalBtn = document.getElementById("close-modal");
            const sortControl = document.getElementById("sort-control");

            const submitNavBtn = document.getElementById("submit-nav-btn");
            const submissionModal = document.getElementById("submission-modal");
            const closeSubmissionModalBtn = document.getElementById(
                "close-submission-modal"
            );
            const submissionForm = document.getElementById("submission-form");
            const contentTypeSelect = document.getElementById("submit-type");
            const customTypeContainer = document.getElementById(
                "custom-type-container"
            );

            function createNavigation() {
                SECTIONS.forEach((section, index) => {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = `#${section}`;
                    a.textContent = section;
                    a.className =
                        "nav-link text-white text-sm md:text-base font-light tracking-widest uppercase pb-2 transition-all";
                    a.dataset.section = section;
                    if (index === 0) a.classList.add("active");
                    li.appendChild(a);
                    navLinksContainer.appendChild(li);
                });
            }

            async function loadSectionContent(sectionName) {
                currentSection = sectionName;
                contentGrid.innerHTML =
                    '<p class="col-span-full text-center">Loading...</p>';
                try {
                    if (!siteContent[sectionName]) {
                        const response = await fetch(`${sectionName}/metadata.json`);
                        if (!response.ok)
                            throw new Error(`metadata.json not found for '${sectionName}'`);
                        const metadata = await response.json();
                        siteContent[sectionName] = { metadata, files: {} };
                    }
                    renderContent(sectionName, sortControl.value);
                } catch (error) {
                    console.error(`Error loading section ${sectionName}:`, error);
                    contentGrid.innerHTML = `<h2 class="col-span-full text-3xl text-center text-gray-500 font-serif-display italic">Content for ${sectionName} coming soon...</h2>`;
                }
            }

            function renderContent(sectionName, sortBy) {
                const metadata = siteContent[sectionName]?.metadata;
                if (!metadata || Object.keys(metadata).length === 0) {
                    contentGrid.innerHTML = `<h2 class="col-span-full text-3xl text-center text-gray-500 font-serif-display italic">No content found in ${sectionName}.</h2>`;
                    return;
                }

                let contentArray = Object.entries(metadata).map(
                    ([fileName, data]) => ({ fileName, ...data })
                );

                contentArray.sort((a, b) => {
                    switch (sortBy) {
                        case "date-asc":
                            return a.fileName.localeCompare(b.fileName);
                        case "title-asc":
                            return a.title.localeCompare(b.title);
                        case "title-desc":
                            return b.title.localeCompare(a.title);
                        case "author-asc":
                            return (a.author || "").localeCompare(b.author || "");
                        case "author-desc":
                            return (b.author || "").localeCompare(a.author || "");
                        case "date-desc":
                        default:
                            return b.fileName.localeCompare(a.fileName);
                    }
                });

                contentGrid.innerHTML = "";
                contentArray.forEach((item) => {
                    const card = document.createElement("div");
                    card.className =
                        "content-card p-6 rounded-lg cursor-pointer transition-all";
                    card.dataset.section = sectionName;
                    card.dataset.filename = item.fileName;
                    card.innerHTML = `
                    <h3 class="font-serif-display text-2xl text-white truncate">${item.title}</h3>
                    <div class="flex items-center text-xs text-gray-500 mt-4 space-x-4">
                        <span id="views-${sectionName}-${item.fileName}">üëÅÔ∏è ${item.views}</span>
                        <span id="likes-${sectionName}-${item.fileName}">‚ù§Ô∏è ${item.likes}</span>
                    </div>
                `;
                    contentGrid.appendChild(card);
                });
            }

            async function openModalWithContent(sectionName, fileName) {
                try {
                    const metadata = siteContent[sectionName].metadata[fileName];
                    let fileContent = siteContent[sectionName].files[fileName];

                    if (!fileContent) {
                        const response = await fetch(`${sectionName}/${fileName}`);
                        if (!response.ok) throw new Error(`File ${fileName} not found.`);
                        fileContent = await response.text();
                        siteContent[sectionName].files[fileName] = fileContent;
                    }

                    if (typeof metadata.views === "number") {
                        metadata.views++;
                        document.getElementById(
                            `views-${sectionName}-${fileName}`
                        ).innerText = `üëÅÔ∏è ${metadata.views}`;
                    }

                    const authorName = metadata.author || "Anonymous";
                    const authorLink = metadata.link || "#";

                    modal.dataset.currentSection = sectionName;
                    modal.dataset.currentFilename = fileName;
                    modalTitle.textContent = metadata.title;
                    modalAuthor.innerHTML = `by <a href="${authorLink}" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors underline">${authorName}</a>`;
                    modalText.textContent = fileContent;

                    modal.classList.remove("hidden");
                    setTimeout(() => {
                        modal.classList.add("opacity-100");
                        modalContentBox.classList.add("scale-100");
                    }, 10);
                } catch (error) {
                    console.error(`Error opening modal for ${fileName}:`, error);
                    alert(`Sorry, could not load the content.`);
                }
            }

            function closeModal() {
                modal.classList.remove("opacity-100");
                modalContentBox.classList.remove("scale-100");
                setTimeout(() => modal.classList.add("hidden"), 300);
            }

            function openSubmissionModal() {
                submissionModal.classList.remove("hidden");
                setTimeout(() => {
                    submissionModal.classList.add("opacity-100");
                    submissionModal
                        .querySelector(".modal-content")
                        .classList.add("scale-100");
                }, 10);
            }

            function closeSubmissionModal() {
                submissionModal.classList.remove("opacity-100");
                submissionModal
                    .querySelector(".modal-content")
                    .classList.remove("scale-100");
                setTimeout(() => {
                    submissionModal.classList.add("hidden");
                    submissionForm.reset(); // Clear the form
                    customTypeContainer.classList.add("hidden"); // Hide custom field
                }, 300);
            }

            function handleFormSubmit(e) {
                e.preventDefault();
                const author = document.getElementById("submit-author").value;
                const title = document.getElementById("submit-title").value;
                let type = contentTypeSelect.value;
                if (type === "Custom") {
                    type =
                        document.getElementById("submit-custom-type").value || "Custom";
                }
                const content = document.getElementById("submit-content").value;

                const email = "miegratsammri@gmail.com";
                const subject = "Miepmorg Content Submission Request";
                const body = `
Author: ${author}
Title: ${title}
Type: ${type}

--- CONTENT ---

${content}
            `;

                const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(
                    subject
                )}&body=${encodeURIComponent(body.trim())}`;

                window.location.href = mailtoLink;

                closeSubmissionModal();
            }

            navLinksContainer.addEventListener("click", (e) => {
                if (e.target.tagName === "A") {
                    const section = e.target.dataset.section;
                    if (!section) return;
                    navLinksContainer
                        .querySelector(".active")
                        .classList.remove("active");
                    e.target.classList.add("active");
                    loadSectionContent(section);
                }
            });

            sortControl.addEventListener("change", () => {
                renderContent(currentSection, sortControl.value);
            });

            contentGrid.addEventListener("click", (e) => {
                const card = e.target.closest(".content-card");
                if (card) {
                    const { section, filename } = card.dataset;
                    openModalWithContent(section, filename);
                }
            });

            closeModalBtn.addEventListener("click", closeModal);
            modal.addEventListener("click", (e) => {
                if (e.target === modal) closeModal();
            });

            modal.addEventListener("click", (e) => {
                if (e.target.classList.contains("reaction-emoji")) {
                    const { currentSection, currentFilename } = modal.dataset;
                    const item = siteContent[currentSection].metadata[currentFilename];
                    if (item && typeof item.likes === "number") {
                        item.likes++;
                        document.getElementById(
                            `likes-${currentSection}-${currentFilename}`
                        ).innerText = `‚ù§Ô∏è ${item.likes}`;

                        e.target.style.transform = "scale(1.5)";
                        setTimeout(() => (e.target.style.transform = "scale(1)"), 200);
                        setTimeout(closeModal, 500);
                    } else if (item && typeof item.likes !== "number") {
                        // If likes are "‚ôæÔ∏è", just give visual feedback and close
                        e.target.style.transform = "scale(1.5)";
                        setTimeout(() => (e.target.style.transform = "scale(1)"), 200);
                        setTimeout(closeModal, 500);
                    }
                }
            });

            submitNavBtn.addEventListener("click", openSubmissionModal);
            closeSubmissionModalBtn.addEventListener("click", closeSubmissionModal);
            submissionModal.addEventListener("click", (e) => {
                if (e.target === submissionModal) closeSubmissionModal();
            });

            contentTypeSelect.addEventListener("change", () => {
                if (contentTypeSelect.value === "Custom") {
                    customTypeContainer.classList.remove("hidden");
                } else {
                    customTypeContainer.classList.add("hidden");
                }
            });

            submissionForm.addEventListener("submit", handleFormSubmit);

            function initializeApp() {
                createNavigation();
                if (SECTIONS.length > 0) {
                    loadSectionContent(SECTIONS[0]);
                }
            }

            initializeApp();
        });
    </script>
</body>

</html>